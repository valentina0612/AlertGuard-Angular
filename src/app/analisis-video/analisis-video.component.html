<div class="app-container">
  <!-- HEADER -->
  <header class="app-header">
    <h1>AlertGuard</h1>
    <p>Detecci√≥n de patrones y escenas an√≥malas con IA</p>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="main-content">
    <!-- CARGA DE VIDEO -->
    <section class="upload-section">
      <div class="upload-area" [class.disabled]="videoUploaded" id="uploadArea">
        <input 
          type="file" 
          (change)="onFileSelected($event)" 
          id="videoUpload" 
          accept="video/*" 
          class="file-input"
          [disabled]="videoUploaded"
        >
        <label for="videoUpload" class="upload-label">
          <div class="upload-icon">
            <i class="fas fa-video"></i>
          </div>
          <h3>Haz clic o arrastra tu video aqu√≠</h3>
          <p class="file-info" id="fileInfo">
            {{ videoUploaded ? 'Video cargado. No se puede subir otro.' : 'Formatos soportados: MP4, AVI, MOV, MKV' }}
          </p>
        </label>
      </div>
    </section>

    <!-- VIDEO EN AN√ÅLISIS -->
    <section class="video-section" *ngIf="videoUploaded">
      <div class="video-processing">
        <canvas #videoCanvas class="video-canvas"></canvas>

        <!-- Frame procesado desde el backend -->
        <div *ngIf="frameUrl" class="processed-frame">
          <img [src]="frameUrl" alt="Video frame procesado" class="video-player" />
        </div>

        <!-- BARRA DE PROGRESO MEJORADA -->
        <div class="progress-container" [class.completed]="progress >= 100" *ngIf="!videoFinished">
          <div class="progress-header">
            <h3>üîÑ Procesando Video</h3>
            <p>Analizando frames con IA...</p>
          </div>
          
          <div class="progress-bar-container">
            <div class="progress-bar">
              <div class="progress-fill" [style.width]="progress + '%'"></div>
            </div>
            
            <div class="progress-milestones">
              <div class="milestone" [class.active]="progress >= 0"></div>
              <div class="milestone" [class.active]="progress >= 25"></div>
              <div class="milestone" [class.active]="progress >= 50"></div>
              <div class="milestone" [class.active]="progress >= 75"></div>
              <div class="milestone" [class.active]="progress >= 100"></div>
            </div>
          </div>
          
          <div class="progress-info">
            <div class="progress-stats">
              <div class="stat-item">
                <span class="stat-value">{{ processedFrames || 0 }}</span>
                <span class="stat-label">Frames</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">{{ (processedFrames || 0) / 25 | number:'1.0-0' }}</span>
                <span class="stat-label">Segundos</span>
              </div>
            </div>
            
            <div class="progress-percentage">
              {{ progress || 0 }}%
            </div>
          </div>
          
          <div class="progress-activity" *ngIf="progress < 100">
            <div class="activity-dots">
              <div class="activity-dot"></div>
              <div class="activity-dot"></div>
              <div class="activity-dot"></div>
            </div>
            <span>Procesando en tiempo real...</span>
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTADOS -->
    <section class="results-section" *ngIf="videoFinished">
      <div class="results-container" id="report-content">
        <!-- ENCABEZADO -->
        <div class="results-header">
          <h2>üéØ Resultados del An√°lisis</h2>
          <p>Sistema dual: YOLO (detecci√≥n de objetos) + Red Neuronal (an√°lisis de comportamiento)</p>
          <p class="analysis-timestamp">üïí {{ analysisResults?.timestamp }}</p>
        </div>

        <!-- GRID DE RESULTADOS -->
        <div class="results-grid">
          <!-- MODELO YOLO -->
          <div class="result-card">
            <h3>üî´ Modelo YOLO - Detecci√≥n de Objetos</h3>
            <div class="metric">
              <span>Armas detectadas:</span>
              <span class="metric-value" [ngClass]="analysisResults?.weapons_detected > 0 ? 'alert' : 'success'">
                {{ analysisResults?.weapons_count || 0 }}
              </span>
            </div>
            <div class="metric">
              <span>Rostros cubiertos:</span>
              <span class="metric-value" [ngClass]="analysisResults?.covered_faces_detected > 0 ? 'warning' : 'success'">
                {{ analysisResults?.covered_count || 0 }}
              </span>
            </div>
        
            <div class="metric">
              <span>Acciones sospechosas:</span>
              <span class="metric-value" [ngClass]="analysisResults?.abnormal_behavior_detected > 0 ? 'warning' : 'success'">
                {{ analysisResults?.abnormal_count || 0 }}
              </span>
            </div>
            <div class="metric">
              <small>Confianza promedio: {{ ((analysisResults?.average_confidence || 0.75) * 100) | number:'1.0-0' }}%</small>
            </div>
          </div>

          <!-- MODELO ANOMAL√çAS -->
          <div class="result-card">
            <h3>‚ö†Ô∏è Modelo Anomal√≠as - Comportamiento</h3>
            <div class="metric">
              <span>Comportamiento an√≥malo:</span>
              <span class="metric-value" [ngClass]="hasAnomaly ? 'warning' : 'success'">
                {{ hasAnomaly ? 'S√ç' : 'NO' }}
              </span>
            </div>
            <div class="metric">
              <span>Secuencias analizadas:</span>
              <span class="metric-value">{{ processedFrames ? (processedFrames / 25 | number:'1.0-0') : 0 }}</span>
            </div>
            <div class="metric">
              <span>Longitud secuencia:</span>
              <span class="metric-value">25 frames</span>
            </div>
            <div *ngIf="hasAnomaly" class="confidence-info">
              <small>Confianza anomal√≠a: {{ anomalyConfidence || 91 }}%</small>
            </div>
          </div>
        </div>

        <!-- DETALLES EXPANDIBLES -->
        <div class="detailed-results">
          <button class="toggle-details-btn" (click)="toggleDetails()">
            <span>{{ showDetails ? 'Ocultar detalles' : 'Ver detalles completos' }}</span>
            <i class="fas fa-chevron-down" [ngClass]="{'rotate': showDetails}"></i>
          </button>

          <div class="detailed-content" *ngIf="showDetails">
            <div class="detections-detail">
              <h3>üîç Detalles de Detecciones ({{ analysisResults?.detections?.length || 0 }} total)</h3>

              <ng-container *ngIf="analysisResults?.detections?.length; else noDetections">
                <div class="detections-stats">
                  <div class="stat-badge weapon">üî´ {{ analysisResults?.weapons_count || 0 }} armas</div>
                  <div class="stat-badge covered">üé≠ {{ analysisResults?.covered_count || 0 }} rostros cubiertos</div>
                  <div class="stat-badge person">üë§ {{ analysisResults?.normal_count || 0 }} personas</div>
                  <div class="stat-badge anomaly">‚ö†Ô∏è {{ analysisResults?.abnormal_count || 0 }} anomal√≠as</div>
                </div>

                <div class="detections-list">
                  <div *ngFor="let det of analysisResults.detections.slice(0,15)" class="detection-item">
                    <span class="detection-type">{{ det.category || det.type }}</span>
                    <span class="detection-confidence">{{ (det.confidence || 0.7) * 100 | number:'1.0-0' }}%</span>
                    <span class="detection-frame">Frame {{ det.frame_number || 'N/A' }}</span>
                  </div>
                </div>

                <p *ngIf="analysisResults.detections.length > 15" class="show-more">
                  + {{ analysisResults.detections.length - 15 }} detecciones m√°s...
                </p>
              </ng-container>

              <ng-template #noDetections>
                <p class="no-detections">No se encontraron detecciones</p>
              </ng-template>
            </div>

            <!-- RESUMEN DE SEGURIDAD -->
            <div class="security-summary" 
                 [ngClass]="(analysisResults?.weapons_detected > 0 || analysisResults?.covered_faces_detected > 0 || analysisResults?.abnormal_behavior_detected > 0) ? 'alert' : 'safe'">
              <h3>
                {{ (analysisResults?.weapons_detected > 0 || analysisResults?.covered_faces_detected > 0 || analysisResults?.abnormal_behavior_detected > 0)
                   ? 'üö® ALERTA DE SEGURIDAD'
                   : '‚úÖ ENTORNO SEGURO' }}
              </h3>
              <div class="summary-content">
                <div *ngIf="analysisResults?.weapons_detected > 0" class="summary-item alert">üî´ Se detectaron armas</div>
                <div *ngIf="analysisResults?.covered_faces_detected > 0" class="summary-item warning">üé≠ Rostros cubiertos</div>
                <div *ngIf="analysisResults?.abnormal_behavior_detected > 0" class="summary-item warning">‚ö†Ô∏è Comportamiento an√≥malo</div>
                <div *ngIf="!analysisResults?.weapons_detected && !analysisResults?.covered_faces_detected && !analysisResults?.abnormal_behavior_detected" class="summary-item safe">
                  ‚úÖ No se detectaron amenazas
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCI√ìN DE DESCARGA MEJORADA -->
      <div class="download-section" *ngIf="videoFinished && analysisResults">
        <div class="download-container">
          <div class="download-header">
            <div class="download-icon">
              <i class="fas fa-file-download"></i>
            </div>
            <div class="download-info">
              <h3>Reporte de An√°lisis Completo</h3>
              <p>Exporta los resultados en diferentes formatos</p>
            </div>
          </div>
          
          <div class="download-buttons">
            <button class="download-btn" (click)="printReport()">
              <span class="btn-icon">
                <i class="fas fa-print"></i>
              </span>
              <span class="btn-text">Imprimir Reporte</span>
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="app-footer">
    <p>&copy; 2025 Alert Guard. Todos los derechos reservados.</p>
  </footer>
</div>